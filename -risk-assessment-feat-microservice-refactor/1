# -*- coding: utf-8 -*-
# @title ğŸ“ˆ å…¨æ™¯å¸‚å ´åˆ†æå„€ v1.0 (å¯¦æˆ°æ¸¬è©¦ç‰ˆ)
# @markdown ### ç³»çµ±ä»‹ç´¹
# @markdown æœ¬è…³æœ¬ç‚ºä¸€å€‹ä¼æ¥­ç´šã€å…¨æ–¹ä½çš„å¸‚å ´åˆ†æå ±å‘Šç”Ÿæˆå¼•æ“ã€‚å®ƒèåˆäº†å®è§€å¸‚å ´æŒ‡æ¨™ã€ç”¢æ¥­é¾é ­åŸºæœ¬é¢èˆ‡æ ¸å¿ƒå¸‚å ´å¾®è§€çµæ§‹ï¼Œæ—¨åœ¨ç‚ºAIæä¾›ä¸€å€‹å‰æ‰€æœªæœ‰çš„ã€åŒ…å«æ·±åº¦èˆ‡å»£åº¦çš„å…¨æ™¯å¸‚å ´è¦–åœ–ã€‚
# @markdown - **V6 æ–¹æ¡ˆå¯¦ä½œ**: å®Œæ•´å¯¦ç¾äº†æˆ‘å€‘æœ€çµ‚è¨è«–çš„ã€Œå…¨æ™¯å¸‚å ´åˆ†æå„€ã€æ–¹æ¡ˆï¼Œçµåˆäº†ã€Œç„¦é»èˆ‡ä¸Šä¸‹æ–‡ã€ä»¥åŠã€Œé¾é ­ä¼æ¥­æ·±åº¦å‰–æã€ã€‚
# @markdown - **100% æœ¬åœ°æ¨¡æ“¬**: ç„¡éœ€ä»»ä½• API é‡‘é‘°æˆ–æ›è¼‰ Google Driveï¼Œå…§å»ºå®Œæ•´çš„æ•¸æ“šæ¨¡æ“¬å™¨ï¼Œå¯ä¸€éµåŸ·è¡Œä¸¦é©—è­‰æ ¸å¿ƒé‚è¼¯ã€‚
# @markdown - **æ™ºæ…§æ•¸æ“šè™•ç†**: è‡ªå‹•å¾æª”åè§£ææ—¥æœŸï¼Œæ™ºæ…§ç”Ÿæˆã€Œæ¯æ—¥é‡åŒ–æ—¥èªŒã€ï¼Œä¸¦åœ¨åµæ¸¬åˆ°ç•°å¸¸æ™‚ä¿ç•™æ›´è©³ç´°çš„æ•¸æ“šã€‚
# @markdown - **æ¨¡çµ„åŒ–è¨­è¨ˆ**: ç¨‹å¼ç¢¼çµæ§‹æ¸…æ™°ï¼Œæ˜“æ–¼ç†è§£ï¼Œä¸¦ç‚ºä¸‹ä¸€æ­¥æ›¿æ›ç‚ºçœŸå¯¦ API (yfinance, Gemini) é ç•™äº†æ¥å£ã€‚
# @markdown ---
# @markdown ### å°ˆæ¡ˆç‰ˆæœ¬æ›´æ–°æ—¥èªŒ (Changelog)
# @markdown - **`v1.0` (ç•¶å‰ç‰ˆæœ¬) - å…¨æ™¯å¸‚å ´åˆ†æå„€ (å¯¦æˆ°æ¸¬è©¦ç‰ˆ)**
# @markdown   - **æ ¸å¿ƒåŠŸèƒ½**: é¦–æ¬¡å®Œæ•´å¯¦ç¾ V6 æ–¹æ¡ˆï¼Œåœ¨ V5 çš„åŸºç¤ä¸ŠåŠ å…¥äº†ã€Œé¾é ­ä¼æ¥­æ·±åº¦å‰–æã€æ¨¡çµ„ã€‚
# @markdown   - **æ•¸æ“šæ“´å……**: å°‡æ¨¡æ“¬æ•¸æ“šæºæ“´å……è‡³åŒ…å«ç¾åœ‹å…¬å‚µæ”¶ç›Šç‡ (TLT, ^IRX, ^FVX, ^TYX) å’Œä¸€å€‹å¯è‡ªè¨‚çš„å…¨çƒé¾é ­ä¼æ¥­è§€å¯Ÿåå–®ã€‚
# @markdown   - **æ·±åº¦åˆ†æ**: ç‚ºé¾é ­ä¼æ¥­æ¨¡æ“¬ç”Ÿæˆä¸¦æå–åŸºæœ¬é¢å¿«ç…§ã€åˆ†æå¸«æƒ…ç·’ã€é—œéµæ–°èå’Œæ©Ÿæ§‹æŒè‚¡ç­‰è³‡è¨Šã€‚
# @markdown   - **æ ¼å¼åŒ–**: æ¡ç”¨äº†æ‚¨å»ºè­°çš„å°ˆæ¥­ Colab æ¨™é ­ (`@title`) èˆ‡ Markdown èªªæ˜ã€‚
# @markdown - **`v0.5` - ç„¦é»èˆ‡ä¸Šä¸‹æ–‡æ··åˆè¡¨ç¤ºæ³• (æœ¬åœ°æ²™ç›¤æ¨æ¼”)**
# @markdown   - **æ ¸å¿ƒåŠŸèƒ½**: åœ¨å–®ä¸€å„²å­˜æ ¼ä¸­ï¼Œå»ºç«‹äº†ç¨ç«‹é‹è¡Œçš„ V5 æ–¹æ¡ˆæ¨¡æ“¬å™¨ã€‚
# @markdown   - **é©—è­‰**: æˆåŠŸé©—è­‰äº†å¾æª”åè§£æã€æ—¥æœŸè¨ˆç®—ã€ã€Œæ¯æ—¥é‡åŒ–æ—¥èªŒã€èˆ‡ã€Œç„¦é»å°æ™‚æ•¸æ“šã€çš„æ··åˆç”Ÿæˆæµç¨‹ã€‚
# @markdown - **`v0.1` - `v0.4` - æ ¸å¿ƒæ¦‚å¿µæ¼”é€²éšæ®µ**
# @markdown   - ç¢ºç«‹äº†å¾ã€Œé€±æ•¸ã€æ›ç®—ã€Œç²¾ç¢ºæ—¥æœŸã€ã€æ“´å¤§æ•¸æ“šçª—å£ã€å¾éœæ…‹æ‘˜è¦é€²åŒ–è‡³åŒ…å«åƒ¹é‡åˆ†æå’Œäº‹ä»¶æ—¥èªŒçš„ã€Œé‡åŒ–æ•˜äº‹æ‘˜è¦ã€ï¼Œä¸¦æœ€çµ‚å®šç‰ˆæ–¼ V5 æ–¹æ¡ˆã€‚

# ==============================================================================
# æ­¥é©Ÿ 0: å°å…¥æ‰€æœ‰å¿…è¦çš„å‡½å¼åº«
# ==============================================================================
import re
import random
from datetime import datetime, timedelta
import pandas as pd

# ==============================================================================
# æ­¥é©Ÿ 1: æ²™ç›¤æ¨æ¼”è¨­å®šå€
# æ‚¨å¯ä»¥åœ¨æ­¤è™•ä¿®æ”¹åƒæ•¸ï¼Œä¾†æ¸¬è©¦ä¸åŒæƒ…å¢ƒ
# ==============================================================================

# æ¨¡æ“¬çš„é€±å ±æª”å
MOCK_FILENAME = "æ¯é€±è©•è«–-2022å¹´ç¬¬43é€±_Geminiè™•ç†.txt"

# æ¨¡æ“¬çš„å®è§€å¸‚å ´å•†å“åˆ—è¡¨
MACRO_TICKERS = [
    '^TWII', '^GSPC', '^IXIC', '^DJI', # è‚¡å¸‚æ ¸å¿ƒ
    'TLT', '^IRX', '^FVX', '^TNX', '^TYX', # åˆ©ç‡/å‚µå¸‚
    '^VIX', '^MOVE', # æƒ…ç·’
    'CL=F', 'GC=F' # å•†å“
]

# æ¨¡æ“¬çš„é¾é ­ä¼æ¥­è§€å¯Ÿåå–®
BELLWETHER_STOCKS = {
    'AAPL': 'è˜‹æœ', 'MSFT': 'å¾®è»Ÿ', 'NVDA': 'è¼é”', 'TSLA': 'ç‰¹æ–¯æ‹‰',
    '2330.TW': 'å°ç©é›»', '2454.TW': 'è¯ç™¼ç§‘',
    'JPM': 'æ‘©æ ¹å¤§é€š', 'WMT': 'æ²ƒçˆ¾ç‘ª'
}


# ==============================================================================
# æ­¥é©Ÿ 2: å»ºç«‹ä¸€å€‹å¼·å¤§çš„æ¨¡æ“¬å™¨ä¾†å–ä»£çœŸå¯¦ API
# åœ¨å¯¦æˆ°ä¸­ï¼Œæˆ‘å€‘æœƒå°‡é€™éƒ¨åˆ†æ›¿æ›ç‚ºçœŸå¯¦çš„ yfinance å‘¼å«
# ==============================================================================

class MockYFinance:
    """ä¸€å€‹åŠŸèƒ½å¼·å¤§çš„ yfinance æ¨¡æ“¬å™¨ï¼Œç”¨ä¾†ç”Ÿæˆé€¼çœŸçš„å‡æ•¸æ“šã€‚"""
    def __init__(self, ticker):
        self.ticker = ticker
        self._info = self._generate_info()
        self._financials = self._generate_financials()
        self._recommendations = self._generate_recommendations()
        self._news = self._generate_news()
        self._holders = self._generate_holders()

    def _generate_info(self):
        industries = ['æ¶ˆè²»é›»å­', 'è»Ÿé«”æœå‹™', 'åŠå°é«”', 'é›»å‹•è»Š', 'éŠ€è¡Œ', 'é›¶å”®']
        return {
            'shortName': BELLWETHER_STOCKS.get(self.ticker, self.ticker),
            'industry': random.choice(industries),
            'marketCap': random.randint(500, 3000) * 1_000_000_000,
            'fiftyTwoWeekLow': random.uniform(80, 120),
            'fiftyTwoWeekHigh': random.uniform(180, 250),
        }

    def _generate_financials(self):
        data = {'Revenue': [random.randint(100, 500) * 1e9 for _ in range(4)],
                'Gross Profit': [random.randint(40, 200) * 1e9 for _ in range(4)]}
        return pd.DataFrame(data, index=[f'202{i}-12-31' for i in range(4)])

    def _generate_recommendations(self):
        firms = ['Morgan Stanley', 'Goldman Sachs', 'J.P. Morgan', 'UBS', 'Citi']
        grades = ['Buy', 'Overweight', 'Hold', 'Sell']
        data = {'Firm': random.sample(firms, 4), 'To Grade': random.choices(grades, k=4)}
        return pd.DataFrame(data)

    def _generate_news(self):
        headlines = [
            f"{self._info['shortName']} ç™¼å¸ƒè¶…é æœŸè²¡å ±ï¼Œç›¤å¾Œè‚¡åƒ¹å¤§æ¼²",
            f"åˆ†æå¸«æ“”æ†‚ {self._info['industry']} å‰æ™¯ï¼Œä¸‹èª¿ {self._info['shortName']} è©•ç´š",
            f"å‚³è {self._info['shortName']} å°‡ç™¼å¸ƒé©å‘½æ€§æ–°ç”¢å“",
            "åŸ·è¡Œé•·è¡¨ç¤ºå°ä¸‹åŠå¹´å¢é•·å……æ»¿ä¿¡å¿ƒ"
        ]
        return [{'title': random.choice(headlines), 'publisher': 'è²¡ç¶“æ—¥å ±'} for _ in range(3)]

    def _generate_holders(self):
        holders = ['Vanguard Group', 'BlackRock Inc.', 'State Street Corp', 'Fidelity']
        data = {'Holder': random.sample(holders, 4), 'Shares': [random.randint(1, 5) * 1e8 for _ in range(4)]}
        return pd.DataFrame(data)

    def history(self, start, end, interval='1d'):
        freq = 'h' if interval == '1h' else 'D'
        dates = pd.to_datetime(pd.date_range(start=start, end=end, freq=freq))
        dates = dates[dates.dayofweek < 5] # éæ¿¾é€±æœ«
        if len(dates) == 0: return pd.DataFrame()

        base_price = random.uniform(100, 500)
        prices = [base_price * (1 + random.uniform(-0.02, 0.02)) for _ in range(len(dates))]

        df = pd.DataFrame(index=dates)
        df['Open'] = [p * random.uniform(0.99, 1.01) for p in prices]
        df['High'] = [max(o, p * random.uniform(1.0, 1.03)) for o, p in zip(df['Open'], prices)]
        df['Low'] = [min(o, p * random.uniform(0.97, 1.0)) for o, p in zip(df['Open'], prices)]
        df['Close'] = [random.uniform(l, h) for l, h in zip(df['Low'], df['High'])]
        df['Volume'] = [random.randint(10, 100) * 1e6 for _ in range(len(dates))]

        if len(df) > 5: # éš¨æ©Ÿè£½é€ ä¸€å€‹æˆäº¤é‡ç•°å¸¸æ—¥
            anomaly_idx = random.randint(1, len(df) - 2)
            df.iloc[anomaly_idx, df.columns.get_loc('Volume')] *= random.uniform(3.5, 5.0)
        return df.round(2)

    @property
    def info(self): return self._info
    @property
    def financials(self): return self._financials
    def get_recommendations(self): return self._recommendations
    def get_news(self): return self._news
    def get_institutional_holders(self): return self._holders

# ==============================================================================
# æ­¥é©Ÿ 3: æ ¸å¿ƒè™•ç†å‡½å¼ (V5 & V6 é‚è¼¯çš„ç¨‹å¼ç¢¼å¯¦ç¾)
# ==============================================================================

def get_candlestick_feature(row):
    """æ ¹æ“šé–‹ç›¤åƒ¹å’Œæ”¶ç›¤åƒ¹ï¼Œç°¡å–®åˆ¤æ–·Kç·šç‰¹å¾µã€‚"""
    body_size = abs(row['Open'] - row['Close'])
    full_range = row['High'] - row['Low']
    if full_range == 0 or body_size / full_range < 0.2: return "åå­—æ˜Ÿ"
    return "é•·ç´…Kç·š" if row['Close'] > row['Open'] else "é•·é»‘Kç·š"

def generate_focus_context_text(ticker, total_start, total_end, focus_start, focus_end):
    """ç”Ÿæˆå®è§€æ•¸æ“šçš„ã€Œç„¦é»èˆ‡ä¸Šä¸‹æ–‡ã€æ–‡æœ¬ã€‚"""
    # å¯¦æˆ°ä¸­ï¼Œé€™è£¡æœƒæ˜¯å¸¶æœ‰é‡è©¦å’Œå¿«å–æ©Ÿåˆ¶çš„ yfinance å‘¼å«
    mock_api = MockYFinance(ticker)
    full_daily_data = mock_api.history(start=total_start, end=total_end, interval='1d')
    full_hourly_data = mock_api.history(start=total_start, end=total_end, interval='1h')
    if full_daily_data.empty: return f"# {ticker}\n- ç„¡æ³•ç²å–æ•¸æ“šã€‚\n"

    output_lines = [f"# {ticker} - å®è§€å¸‚å ´æ•¸æ“š\n"]
    output_lines.append("# PART 1: å®è§€ä¸Šä¸‹æ–‡ (å‰å¾Œå„2å€‹æœˆ) - æ¯æ—¥é‡åŒ–æ—¥èªŒ")

    avg_volume = full_daily_data['Volume'].mean()
    context_data = full_daily_data[(full_daily_data.index.date < focus_start.date()) | (full_daily_data.index.date > focus_end.date())]

    for date, row in context_data.iterrows():
        daily_change = (row['Close'] / row['Open'] - 1) * 100
        k_feature = get_candlestick_feature(row)
        volume_rating = row['Volume'] / avg_volume if avg_volume > 0 else 0
        log_line = f"- {date.strftime('%Y-%m-%d')}: {daily_change:+.1f}%, {k_feature}, æˆäº¤é‡:{volume_rating:.1f}x"
        output_lines.append(log_line)

        if volume_rating > 3.0:
            output_lines.append("  - [åµæ¸¬åˆ°é—œéµäº‹ä»¶æ—¥ï¼šé™„ä¸Šç•¶æ—¥å®Œæ•´å°æ™‚ç·šæ•¸æ“š]")
            anomaly_hourly_data = full_hourly_data[full_hourly_data.index.date == date.date()]
            output_lines.append("    " + anomaly_hourly_data.to_string().replace('\n', '\n    '))

    output_lines.append(f"\n# PART 2: ç„¦é»åˆ†æå€ (æ ¸å¿ƒé€±: {focus_start.strftime('%Y-%m-%d')} to {focus_end.strftime('%Y-%m-%d')})")
    output_lines.append("- æä¾›æœ¬é€±å®Œæ•´ã€æœªç¶“å£“ç¸®çš„åŸå§‹å°æ™‚ç·šæ•¸æ“š")
    focus_hourly_data = full_hourly_data[(full_hourly_data.index.date >= focus_start.date()) & (full_hourly_data.index.date <= focus_end.date())]
    output_lines.append(focus_hourly_data.to_string())

    return "\n".join(output_lines)

def generate_deep_dive_text(ticker):
    """ç‚ºé¾é ­ä¼æ¥­ç”Ÿæˆæ·±åº¦å‰–ææ‘˜è¦ã€‚"""
    # å¯¦æˆ°ä¸­ï¼Œé€™è£¡æœƒæ˜¯å¸¶æœ‰é‡è©¦å’Œå¿«å–æ©Ÿåˆ¶çš„ yfinance å‘¼å«
    mock_api = MockYFinance(ticker)
    info = mock_api.info
    financials = mock_api.financials
    recom = mock_api.get_recommendations()
    news = mock_api.get_news()
    holders = mock_api.get_institutional_holders()

    lines = [f"- **{info['shortName']} ({ticker})**"]
    try:
        rev_g = (financials['Revenue'].iloc[-1] / financials['Revenue'].iloc[-2] - 1) * 100
        lines.append(f"  - åŸºæœ¬é¢: ç”¢æ¥­({info['industry']}), å¸‚å€¼({info['marketCap']/1e9:.1f}B), æœ€æ–°ç‡Ÿæ”¶å¹´å¢({rev_g:.1f}%)")
    except:
        lines.append(f"  - åŸºæœ¬é¢: ç”¢æ¥­({info['industry']}), å¸‚å€¼({info['marketCap']/1e9:.1f}B)")

    lines.append(f"  - åˆ†æå¸«æƒ…ç·’: {recom['To Grade'].value_counts().to_dict()}")
    if news: lines.append(f"  - é—œéµæ–°è: \"{news[0]['title']}\" ({news[0]['publisher']})")
    if not holders.empty: lines.append(f"  - ä¸»è¦æ©Ÿæ§‹æŒè‚¡: {list(holders['Holder'].iloc[:2])}")

    return "\n".join(lines)

# ==============================================================================
# æ­¥é©Ÿ 4: ä¸»åŸ·è¡Œå‡½å¼ - å•Ÿå‹•æˆ‘å€‘çš„å…¨æ™¯å¸‚å ´åˆ†æå„€
# ==============================================================================

def run_panoramic_simulation():
    """ä¸»æ¨¡æ“¬æ¸¬è©¦å‡½å¼ï¼Œæ•´åˆæ‰€æœ‰æ¨¡å¡Šã€‚"""
    print(f"--- é–‹å§‹é‡å°æª”å '{MOCK_FILENAME}' é€²è¡Œ V6 å…¨æ™¯åˆ†æå„€æ²™ç›¤æ¨æ¼” ---")

    # 1. è§£ææª”åï¼Œè¨ˆç®—æ—¥æœŸ
    match = re.search(r'(\d{4})å¹´ç¬¬(\d{1,2})é€±', MOCK_FILENAME)
    year, week_num = map(int, match.groups())
    focus_start = datetime.fromisocalendar(year, week_num, 1)
    focus_end = focus_start + timedelta(days=6)
    total_start = focus_start - timedelta(days=60)
    total_end = focus_end + timedelta(days=60)
    print(f"\n[æ­¥é©Ÿ 1/4] æˆåŠŸè§£ææ—¥æœŸ -> ç„¦é»é€±: {focus_start.strftime('%Y-%m-%d')} to {focus_end.strftime('%Y-%m-%d')}")

    # 2. ç”Ÿæˆå®è§€å¸‚å ´æ•¸æ“šä¸Šä¸‹æ–‡
    print("\n[æ­¥é©Ÿ 2/4] æ­£åœ¨ç”Ÿæˆå®è§€å¸‚å ´çš„ã€Œç„¦é»èˆ‡ä¸Šä¸‹æ–‡ã€æ•¸æ“š...")
    macro_context_text = []
    for ticker in MACRO_TICKERS:
        text = generate_focus_context_text(ticker, total_start, total_end, focus_start, focus_end)
        macro_context_text.append(text)
        print(f"  - å·²è™•ç†å®è§€æŒ‡æ¨™: {ticker}")

    # 3. ç”Ÿæˆé¾é ­ä¼æ¥­æ·±åº¦å‰–æ
    print("\n[æ­¥é©Ÿ 3/4] æ­£åœ¨ç”Ÿæˆé¾é ­ä¼æ¥­çš„ã€Œæ·±åº¦å‰–æã€æ•¸æ“š...")
    deep_dive_texts = []
    for ticker in BELLWETHER_STOCKS.keys():
        text = generate_deep_dive_text(ticker)
        deep_dive_texts.append(text)
        print(f"  - å·²å‰–æé¾é ­ä¼æ¥­: {ticker}")

    # 4. å»ºç«‹æœ€çµ‚çš„ã€Œå…¨æ™¯ã€Prompt
    mock_philosophy = """
# ã€Œåˆ€ç–¤è€äºŒã€äº¤æ˜“ç­–ç•¥æ ¸å¿ƒï¼šç­‰å¾…ã€ç´€å¾‹ã€é †å‹¢ã€‚åªåšçœ‹å¾—æ‡‚çš„è¡Œæƒ…ï¼Œåœ¨é—œéµæ”¯æ’å£“åŠ›ä½å‡ºæ‰‹ã€‚
# ã€Œäº¤æ˜“é†«ç”Ÿã€æ ¸å¿ƒè§€é»ï¼šé‡è¦–åƒ¹é‡é—œä¿‚ï¼Œé‡æ˜¯åƒ¹çš„å…ˆè¡ŒæŒ‡æ¨™ï¼Œä»»ä½•æ²’æœ‰é‡èƒ½æ”¯æ’çš„çªç ´éƒ½å€¼å¾—æ‡·ç–‘ã€‚
# ã€Œå–„ç”²ç‹¼ã€æŠ•è³‡å“²å­¸ï¼šé‡è¦–ç”¢æ¥­è¶¨å‹¢èˆ‡é¾é ­å…¬å¸çš„è­·åŸæ²³ï¼Œç›¸ä¿¡é•·æœŸåƒ¹å€¼ã€‚
# ... (æ­¤è™•çœç•¥å…¶ä»–å¿ƒæ³•) ...
"""
    mock_report_content = f"é€™æ˜¯ {year}å¹´ç¬¬{week_num}é€± çš„å¸‚å ´è©•è«–ã€‚æœ¬é€±å¸‚å ´æƒ…ç·’åœ¨ä¸­ç¾è²¿æ˜“è«‡åˆ¤çš„å½±éŸ¿ä¸‹é¡¯å¾—æ ¼å¤–è¬¹æ…ï¼Œç§‘æŠ€è‚¡è¡¨ç¾ç–²è»Ÿï¼Œä½†å‚³ç”¢è‚¡æœ‰è³‡é‡‘æµå…¥è·¡è±¡..."

    final_prompt = f"""
# ==========================================================
# --- AI ç­–ç•¥åˆ†æä»»å‹™ (V6 å…¨æ™¯åˆ†æå„€) ---
# ==========================================================

## ä½ çš„è§’è‰²èˆ‡èƒŒæ™¯çŸ¥è­˜
ä½ æ˜¯ä¸€ä½èåˆäº†ä»¥ä¸‹å¸‚å ´å¤§å¸«æ™ºæ…§çš„é ‚å°–é‡åŒ–ç­–ç•¥å¸«ã€‚ä½ çš„åˆ†æå¿…é ˆåŒæ™‚å…¼é¡§å®è§€ç¶“æ¿Ÿã€ç”¢æ¥­è¶¨å‹¢å’Œå€‹è‚¡åŸºæœ¬é¢ã€‚
{mock_philosophy}
---
## æœ¬æ¬¡æ ¸å¿ƒåˆ†ææ¨™çš„
**é€±å ±æ¨™é¡Œ:** {MOCK_FILENAME}
**é€±å ±å…§å®¹:** {mock_report_content}
---
## PART 1: å®è§€å¸‚å ´ä¸Šä¸‹æ–‡ (æ¯æ—¥é‡åŒ–æ—¥èªŒ)
{chr(10).join(macro_context_text)}
---
## PART 2: é¾é ­ä¼æ¥­åŸºæœ¬é¢å‰–æ (ç„¦é»é€±æœŸé–“)
{chr(10).join(deep_dive_texts)}
---
## PART 3: æ ¸å¿ƒç„¦é»åˆ†æå€ (ç•¶é€±å®Œæ•´å°æ™‚ç·šæ•¸æ“š)
[è¨»ï¼šç‚ºä¿æŒè¼¸å‡ºç°¡æ½”ï¼Œæ­¤è™•åƒ…ç¤ºæ„ã€‚åœ¨ PART 1 çš„æ•¸æ“šä¸­å·²åŒ…å« ^TWII å’Œ ^GSPC çš„è©³ç´°å°æ™‚æ•¸æ“š]
---
## ä½ çš„ä»»å‹™èˆ‡ç”¢å‡ºè¦æ±‚
è«‹åš´æ ¼ä¾ç…§ä½ çš„æ ¸å¿ƒäº¤æ˜“å“²å­¸ï¼Œçµåˆä»¥ä¸Šä¸‰å€‹éƒ¨åˆ†çš„å…¨éƒ¨è³‡è¨Šï¼Œå®Œæˆä»¥ä¸‹ä»»å‹™ï¼š

1.  **ç™¼æ˜é«˜å®¹éŒ¯äº¤æ˜“æ©Ÿæœƒ**ï¼šæ‰¾å‡ºç¬¦åˆä½ å“²å­¸çš„ã€Œæ³¢æ®µäº¤æ˜“ã€æˆ–ã€Œé…å°äº¤æ˜“ã€æ©Ÿæœƒã€‚ä½ çš„å»ºè­°ä¸æ‡‰è¿½æ±‚å¾®ç§’ç´šçš„åæ‡‰é€Ÿåº¦ï¼Œè€Œæ˜¯å¯ä»¥æå‰æ•¸å°æ™‚ç”šè‡³ä¸€å¤©é€²è¡Œè¦åŠƒçš„ç­–ç•¥ã€‚
2.  **æä¾›å®Œæ•´ç­–ç•¥ç´°ç¯€**ï¼šåŒ…å«æ ¸å¿ƒé‚è¼¯ã€é—œéµè§€æ¸¬æŒ‡æ•¸/å€‹è‚¡ã€é€²å ´æ™‚æ©Ÿã€ä»¥åŠåˆæ­¥çš„é¢¨éšªæ§ç®¡æƒ³æ³•ã€‚
3.  **æå‡ºé‡åŒ–ç ”ç©¶æ–¹å‘**ï¼šåŸºæ–¼æœ¬æ¬¡å¸‚å ´æƒ…æ³ï¼Œæå‡º 1-2 å€‹å€¼å¾—æ·±å…¥ç ”ç©¶çš„ã€Œé‡åŒ–å› å­ã€æˆ–ã€Œæ¨¡å‹æ€è·¯ã€ã€‚
4.  **æä¾›å¤šæ™‚é–“æ¡†æ¶å±•æœ›**ï¼šå°æœªä¾† **ä¸€é€±ã€ä¸€å€‹æœˆã€ç”šè‡³ä¸€å­£** çš„æ½›åœ¨å½±éŸ¿èˆ‡é æœŸã€‚
"""

    print("\n[æ­¥é©Ÿ 4/4] æˆåŠŸç”Ÿæˆæœ€çµ‚è¦æäº¤çµ¦ Gemini çš„ã€Œå…¨æ™¯åˆ†æå„€ã€Promptã€‚")
    print("\n\n" + "="*25 + "â†“â†“â†“ æœ€çµ‚è¼¸å‡ºé è¦½ â†“â†“â†“" + "="*25)
    print(final_prompt)
    print("="*25 + "â†‘â†‘â†‘ æœ€çµ‚è¼¸å‡ºé è¦½ â†‘â†‘â†‘" + "="*25)
    print("\n--- å…¨æ™¯åˆ†æå„€æ²™ç›¤æ¨æ¼”å®Œæˆï¼---")

# --- åŸ·è¡Œæ²™ç›¤æ¨æ¼” ---
run_panoramic_simulation()
